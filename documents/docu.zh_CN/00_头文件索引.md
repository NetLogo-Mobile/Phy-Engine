# 00 头文件索引（`include/phy_engine/`）

本章给出 `include/phy_engine/` 的“模块地图”，用于在不读完整源码的前提下，快速找到对应功能的入口头文件与命名空间。

## 1) 一站式聚合头文件

- `include/phy_engine/phy_engine.h`

特点：

- 方便上手：会 include 常用网表/求解器接口 + 一批常见模型
- 不保证覆盖全部模型/扩展：需要某个具体器件时，仍建议显式 include 对应模型头文件

## 2) 电路求解（模拟 + 数字混合）

目录：`include/phy_engine/circuits/`

- `circuit.h`：核心类型 `phy_engine::circult`（求解器上下文），以及 `analyze()/digital_clk()` 等入口
- `analyze.h`：`phy_engine::analyze_type`（OP/DC/AC/TR…）
- `environment/environment.h`：`phy_engine::environment`（容差、温度、r_open…）
- `analyzer/*.h`：各分析参数结构体（AC/DC/OP/TR）与 `analyzer_storage_t`
- `digital/update_table.h`：数字更新表与“数字驱动模拟节点”的桥接结构
- `MNA/mna.h`：MNA 矩阵/向量结构（模型实现会用；一般用户可忽略）
- `solver/cuda_sparse_lu.h`：可选 CUDA 稀疏求解（需 NVCC + CUDA 运行时）
- `floating_subnet/detect.h`：浮空子网检测（网表不接地排查）
- `optimizer/Gmin.h`：Gmin 相关结构（目前偏占位/内部用）

## 3) 网表构建与编辑

目录：`include/phy_engine/netlist/`

- `netlist.h`：`netlist::netlist` 数据结构（models/nodes/ground_node）
- `operation.h`：构建/编辑 API（`add_model/create_node/add_to_node/...`）
- `impl.h`：便捷聚合 include（`concept.h + netlist.h + operation.h`）
- `concept.h`：对 `add_model` 等模板约束的概念定义

## 4) 模型系统（器件接口、节点/引脚/支路）

目录：`include/phy_engine/model/`

基础数据结构：

- `node/*`：`node_t`、`node_view`（模拟电压/数字 4 态）
- `pin/*`：`pin`、`pin_view`
- `branch/*`：`branch`、`branch_view`
- `property/property.h`：属性/属性表（偏扩展/元数据）

模型系统（类型擦除 + concept）：

- `model_refs/base.h`：`model_base`（虚表接口 + 存储）
- `model_refs/variant.h`：`variant`（统一参数/状态类型）
- `model_refs/type.h`：`model_type` / `model_device_type`
- `model_refs/concept.h`：模型需要实现的 `*_define(...)` 概念约束

内置模型库：

- `model/models/.../*.h`（完整清单见 `05_模型库清单.md`）

## 5) Verilog（两条路径）

目录：`include/phy_engine/verilog/`

推荐（可综合子集）：

- `digital/digital.h`：Verilog 可综合子集的预处理/编译/展开/仿真
- `digital/pe_synth.h`：把 elaboration 结果综合到 PE 数字 primitive 网表

legacy（兼容测试/旧接口）：

- `parser/parser.h` + `parser/*`：当前更偏“词法化/占位”的旧接口
- `ast/*`：旧 AST 数据结构（目前用途有限）

## 6) PhysicsLab `.sav` 互操作

目录：`include/phy_engine/phy_lab_wrapper/`

- `physicslab.h`：`.sav` JSON 读写与数据结构（experiment/element/wire）
- `pe_sim.h`：PL→PE 仿真适配（基于 `dll_api.h` 的 C ABI）
- `pe_to_pl.h`：PE→PL 导出（把 PE 网表转成 `.sav`）
- `layout_locator.h`：布局定位辅助（四角标记 → 坐标系映射）
- `pe_model_id.h`：集中管理 PhysicsLab `ModelID` 字符串常量
- `c_api.h`：wrapper 层最小 C API（便于 wasm/绑定；非求解器 ABI）

## 7) 求解器 C ABI（动态库嵌入）

- `include/phy_engine/dll_api.h`：`create_circuit/analyze_circuit/circuit_sample/...`

实现通常在：

- `src/dll_main.cpp`（本仓库默认实现）

## 8) 文件格式解析（占位/待完善）

- `include/phy_engine/parser/file_format/impl.h`

## 9) 工具/基础设施

目录：`include/phy_engine/utils/`

- `version.h`：版本结构与打印
- 其它文件多为 IO/平台/控制台辅助（用于工具或库内部）

